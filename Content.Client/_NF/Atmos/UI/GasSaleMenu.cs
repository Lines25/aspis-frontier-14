using Content.Client.UserInterface.Controls;
using Content.Shared._NF.Bank;
using Content.Shared.Atmos;
using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.XAML;
using Robust.Shared.Utility;

namespace Content.Client._NF.Atmos.UI;

[GenerateTypedNameReferences]
public sealed partial class GasSaleMenu : FancyWindow
{
    public Action? SellRequested;

    public static readonly string[] GasStrings =
    [
        "gases-nitrogen", // 0
        "gases-oxygen", // 1
        "gases-co2", // 2
        "gases-plasma", // 3
        "gases-tritium", // 4
        "gases-water-vapor", // 5
        "gases-ammonia", // 6
        "gases-n2o", // 7
        "gases-frezon", // 8
    ];

    public string FallbackGasString = "gas-fallback";

    public GasSaleMenu()
    {
        RobustXamlLoader.Load(this);
        SellButton.OnPressed += OnSellPressed;
    }

    public void SetMixture(GasMixture mixture, int appraisal)
    {
        FormattedMessage label = new();
        FormattedMessage values = new();
        for (int i = 0; i < Atmospherics.TotalNumberOfGases; i++)
        {
            if (i < GasStrings.Length)
                label.AddMarkupOrThrow(Loc.GetString(GasStrings[i]));
            else
                label.AddMarkupOrThrow(Loc.GetString(FallbackGasString, ("number", i)));
            label.PushNewline();

            values.AddMarkupOrThrow(Loc.GetString("gas-sale-menu-quantity", ("value", mixture.GetMoles(i))));
            values.PushNewline();
        }
        Gases.Text = label.ToString();
        GasAmounts.Text = values.ToString();
        AppraisalLabel.Text = BankSystemExtensions.ToSpesoString(appraisal);
    }
    public void SetEnabled(bool enabled)
    {
        SellButton.Disabled = !enabled;
    }

    private void OnSellPressed(BaseButton.ButtonEventArgs obj)
    {
        SellRequested?.Invoke();
    }
}
